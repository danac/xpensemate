{% extends "base_layout.htm" %}

{% block title %} Xpensemate > {{ group.name }} {% endblock %}

{% block top_navigation %}
<li> &raquo;&nbsp; <a href="/groups">Groups</a></li>
<li> &raquo;&nbsp; {{ group.name }}</li>
{% endblock %}

{% block sidebar %}
<ul>
    <li class="toctree-l1 current"><a class="reference internal" href="/groups">My groups</a>
        <ul>
        {% for other_group in groups %}
            {% if other_group.name != group.name %}
            <li class="toctree-l2"><a class="reference internal" href="/groups/{{ other_group.group_id }}">{{ other_group.name }}</a></li>
            {% else %}
            <li class="toctree-l2 current"><a class="reference internal" href="/groups/{{ other_group.group_id }}">{{ other_group.name }}</a></li>
            {% endif %}
        {% endfor %}
        </ul>
    <li class="toctree-l1"><a class="reference internal" href="/logout">Logout</a>
    </li>
</ul>
{% endblock %}

{% block main_content %}
<div class="section" id="xpensemate">
    <h1>Group {{ group.name }}</h1>
    
    {% block notification %}
    {% endblock %}
    
    <div class="section" id="project-documentation">
        
        <h2>Debts</h2>
        {% if group.expenses|length > 0 or group.transfers|length > 0 %}
            <div class="wy-table-responsive">
                <table class="docutils" border="1" style="width: 100%; table-layout: fixed; word-break: break-all; word-wrap: break-word; -moz-hyphens: auto;">
                    <tbody valign="top">
                        {% for member in group.debts.keys() %}
                            <tr>
                                <td>{{ member }} owes...</td>
                                <td>
                                        {% for other_member in group.debts[member].keys() %}
                                            {% if ((group.debts[member][other_member]|float/0.05)|round*0.05)|abs > 0 %}
                                            {{ other_member }} : {{ "%0.2f"|format((group.debts[member][other_member]|float/0.05)|round*0.05) }}
                                            {% endif %}
                                        {% endfor %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        
        
        
        {% endif %}
        
        <h2>Expenses</h2>
        {% if group.expenses|length > 0 %}
            <div class="wy-table-responsive">
                <table class="docutils" border="1" style="width: 100%; table-layout: fixed; word-break: break-all; word-wrap: break-word; -moz-hyphens: auto;">
                    <colgroup>
                        <col width="15%">
                        <col width="13%">
                        <col width="40%">
                        <col width="16%">
                    </colgroup>
                    <thead valign="bottom">
                        <tr class="row-odd">
                            <th class="head" style="border-right:1px solid #E1E4E5">Date</th>
                            <th class="head" style="border-right:1px solid #E1E4E5">Amount</th>
                            <th class="head" style="border-right:1px solid #E1E4E5">Description</th>
                            <th class="head" style="border-right:1px solid #E1E4E5">Members</th>
                        </tr>
                    </thead>
                    <tbody valign="top">
                        {% for expense in group.expenses %}
                            <tr class="row-odd">
                                <td>{{ expense.date }}</td>
                                <td>{{ "%0.2f"|format((expense.amount|float/0.05)|round*0.05) }}</td>
                                <td>{{ expense.description }}</td>
                                <td>
                                    {% for member in group.member_balance.keys()|sort %}
                                        {% if member == expense.maker %}
                                            <span style="color:#274FAE">&#10026;
                                        {% elif member in expense.members %}
                                            <span style="color:#27AE60">&#10004;
                                        {% else %}
                                            <span style="color:#B80000">&#10007;
                                        {% endif %}
                                            {{ member }}</span><br />
                                    {% endfor %}
                                </td>
                            </tr>
                        {% endfor %}
                        <tr>
                        <form id="new-expense-form" class="wy-form" action="/new_expense" method="post">
                            <input name="csrf_token" type=hidden value="{{ get_csrf_token() }}">
                            <input type="submit" style="position: absolute; left: -9999px; width: 1px; height: 1px;"/>
                        
                        <td>
                            <input type="text" name="date_info" placeholder="Date" style="width:100%;border-radius: 50px;padding: 6px 12px;"/>
                        </td>
                        <td>
                            <input type="text" name="date_info" placeholder="Amount" style="width:100%;border-radius: 50px;padding: 6px 12px;"/>
                        </td>
                        <td>
                            <input type="text" name="date_info" placeholder="Description" style="width:85%;border-radius: 50px;padding: 6px 12px;"/>
                            <a id="new-expense-submit" href="#" onclick="document.getElementById('new-expense-form').submit();" class="" style="margin-left:5px">OK <span class="fa fa-arrow-circle-right"></span></a>
                        </td>
                        <td>
                            {% for member in group.member_balance.keys()|sort %}
                                <input type="checkbox" name="{{ member }}" value="" checked="yes">{{ member }}<br>
                            {% endfor %}
                        </td>
                        </form>
                        </tr>
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No expenses yet.</p>
        {% endif %}
        
        <h2>Transfers</h2>
        {% if group.transfers|length > 0 %}
            <div class="wy-table-responsive">
                <table class="docutils" border="1" style="width: 100%; table-layout: fixed; word-break: break-all; word-wrap: break-word; -moz-hyphens: auto;">
                    <colgroup>
                        <col width="15%">
                        <col width="13%">
                        <col width="56%">
                    </colgroup>
                    <thead valign="bottom">
                        <tr class="row-odd">
                            <th class="head" style="border-right:1px solid #E1E4E5">Date</th>
                            <th class="head" style="border-right:1px solid #E1E4E5">Amount</th>
                            <th class="head" style="border-right:1px solid #E1E4E5">From/To</th>
                        </tr>
                    </thead>
                    <tbody valign="top">
                        {% for transfer in group.transfers %}
                            <tr class="row-odd">
                                <td>{{ transfer.date }}</td>
                                <td>{{ (transfer.amount*100)|round|int/100 }}</td>
                                <td>
                                    {{ transfer.from_member}} <big>&#10148;</big> {{ transfer.to_member }}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>No transfers yet.</p>
        {% endif %}
        
    </div>
    
</div>


{% endblock %}
